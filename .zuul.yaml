- job:
    name: gophercloud-unittest
    parent: golang-test
    description: |
      Run gophercloud unit test
    run: .zuul/playbooks/gophercloud-unittest/run.yaml
    nodeset: ubuntu-xenial-ut

- job:
    name: gophercloud-acceptance-test
    parent: golang-test
    description: |
      Run gophercloud acceptance test on master branch
    run: .zuul/playbooks/gophercloud-acceptance-test/run.yaml
    timeout: 18000 # 5 hours
    nodeset: ubuntu-focal
    vars:
      # the list of all available tests can generated by:
      # find acceptance/openstack -name '*_test.go' -exec dirname {} \; | sort -n | uniq -c | awk '{print $2}'
      acceptance_tests:
        - acceptance/openstack
        - acceptance/openstack/blockstorage
        - acceptance/openstack/blockstorage/extensions
        - acceptance/openstack/blockstorage/v3
        - acceptance/openstack/compute/v2
        - acceptance/openstack/container/v1
        - acceptance/openstack/dns/v2
        - acceptance/openstack/identity/v2
        - acceptance/openstack/identity/v3
        - acceptance/openstack/imageservice/v2
        - acceptance/openstack/keymanager/v1
        - acceptance/openstack/loadbalancer/v2
        - acceptance/openstack/networking/v2
        - acceptance/openstack/networking/v2/extensions
        - acceptance/openstack/networking/v2/extensions/agents
        - acceptance/openstack/networking/v2/extensions/dns
        - acceptance/openstack/networking/v2/extensions/layer3
        - acceptance/openstack/networking/v2/extensions/mtu
        - acceptance/openstack/networking/v2/extensions/networkipavailabilities
        - acceptance/openstack/networking/v2/extensions/portsbinding
        - acceptance/openstack/networking/v2/extensions/qos/policies
        - acceptance/openstack/networking/v2/extensions/qos/rules
        - acceptance/openstack/networking/v2/extensions/qos/ruletypes
        - acceptance/openstack/networking/v2/extensions/quotas
        - acceptance/openstack/networking/v2/extensions/rbacpolicies
        - acceptance/openstack/networking/v2/extensions/subnetpools
        - acceptance/openstack/networking/v2/extensions/trunks
        - acceptance/openstack/networking/v2/extensions/vlantransparent
        - acceptance/openstack/objectstorage/v1
        - acceptance/openstack/orchestration/v1
        - acceptance/openstack/placement/v1
        - acceptance/openstack/sharedfilesystems/v2
        - acceptance/openstack/sharedfilesystems/v2/messages
      devstack_services:
        - designate
        - manila
        - neutron-ext
        - octavia
        - zun

- job:
    name: gophercloud-acceptance-test-ironic
    parent: golang-test
    description: |
      Run gophercloud ironic acceptance test on master branch
    run: .zuul/playbooks/gophercloud-acceptance-test/run.yaml
    nodeset: ubuntu-focal
    vars:
      devstack_services:
        - ironic
      devstack_override_enabled_services: 'g-api,g-reg,q-agt,q-dhcp,q-l3,q-svc,key,mysql,rabbit,ir-api,ir-cond,s-account,s-container,s-object,s-proxy'
      devstack_projects: 'openstack/ironic-python-agent-builder openstack/ironic'
      acceptance_tests:
        - acceptance/openstack/baremetal/v1

- job:
    name: gophercloud-acceptance-test-ussuri
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on ussuri branch
    vars:
      global_env:
        OS_BRANCH: stable/ussuri

- job:
    name: gophercloud-acceptance-test-train
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on train branch
    vars:
      global_env:
        OS_BRANCH: stable/train

- job:
    name: gophercloud-acceptance-test-stein
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on stein branch
    vars:
      global_env:
        OS_BRANCH: stable/stein

- job:
    name: gophercloud-acceptance-test-rocky
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on rocky branch
    vars:
      global_env:
        OS_BRANCH: stable/rocky

- job:
    name: gophercloud-acceptance-test-queens
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on queens branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/queens

# NOTE: A Pike-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-pike
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on pike branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/pike

- job:
    name: gophercloud-acceptance-test-ocata
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on ocata branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/ocata

# NOTE: A Newton-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-newton
    parent: gophercloud-acceptance-test
    description: |
      Run gophercloud acceptance test on newton branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/newton

- project:
    name: gophercloud/gophercloud
    check:
      jobs:
        - gophercloud-unittest
        - gophercloud-acceptance-test
        - gophercloud-acceptance-test-ironic
    recheck-newton:
      jobs:
        - gophercloud-acceptance-test-newton
    recheck-ocata:
      jobs:
        - gophercloud-acceptance-test-ocata
    recheck-pike:
      jobs:
        - gophercloud-acceptance-test-pike
    recheck-queens:
      jobs:
        - gophercloud-acceptance-test-queens
    recheck-rocky:
      jobs:
        - gophercloud-acceptance-test-rocky
    recheck-stein:
      jobs:
        - gophercloud-acceptance-test-stein
    recheck-train:
      jobs:
        - gophercloud-acceptance-test-train
    recheck-ussuri:
      jobs:
        - gophercloud-acceptance-test-ussuri
